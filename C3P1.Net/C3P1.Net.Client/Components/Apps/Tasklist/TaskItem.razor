@using C3P1.Net.Shared.Data.Apps.Tasklist
@using C3P1.Net.Shared.Services.Apps;
@inject ITasklistService TasklistService

@if (Item != null)
{
    <ListGroupItem>
        <Field Horizontal Padding="Padding.IsAuto.OnAll">
            <FieldBody ColumnSize="ColumnSize.Is1">
                <Check TValue="bool"
                       Checked="@Item.Completed"
                       CheckedChanged="@(async (bool isChecked) => await OnCheckedChanged(isChecked))">
                </Check>
            </FieldBody>
            <FieldBody ColumnSize="ColumnSize.Is11">
                @Item.Title
            </FieldBody>
        </Field>
    </ListGroupItem>
}

@code {
    [Parameter]
    public TodoItem? Item { get; set; }

    [Parameter]
    public Func<bool, Task>? StatusChanged { get; set; }

    async Task OnCheckedChanged(bool isChecked)
    {
        // update item in database
        Item!.Completed = isChecked;
        await TasklistService.UpdateTaskAsync(Item!);

        if (StatusChanged != null)
            await StatusChanged.Invoke(isChecked);
    }
}